# CEX Arbitrage Engine Configuration
# YAML-based configuration for multi-exchange cryptocurrency trading

# Environment settings
environment:
  name: dev  # dev, prod, test
  debug: true
  log_level: DEBUG  # CRITICAL, ERROR, WARNING, INFO, DEBUG

# Database configuration
database:
  host: "${POSTGRES_HOST}"          # Set via environment variable POSTGRES_HOST (default: localhost)
  port: "${POSTGRES_PORT}"          # Set via environment variable POSTGRES_PORT (default: 5432)
  database: "${POSTGRES_DB}"        # Set via environment variable POSTGRES_DB (default: cex_arbitrage)
  username: "${POSTGRES_USER}"      # Set via environment variable POSTGRES_USER
  password: "${POSTGRES_PASSWORD}"  # Set via environment variable POSTGRES_PASSWORD
  
  # Connection Pool Settings (HFT-optimized)
  pool:
    min_size: 5                     # Minimum connections in pool
    max_size: 20                    # Maximum connections in pool  
    max_queries: 50000              # Max queries per connection before refresh
    max_inactive_connection_lifetime: 300.0  # 5 minutes
    command_timeout: 10.0           # Command timeout in seconds
    
  # Performance Settings
  performance:
    statement_cache_size: 1024      # Prepared statement cache
    enable_asyncpg_record: true     # Use asyncpg.Record for better performance
    enable_connection_logging: false # Disable for production HFT
    
  # Migration Settings  
  migrations:
    enabled: true                   # Enable automatic migrations on startup
    directory: "db/migrations"      # Migration files directory

# Exchange API settings - Enhanced with RestTransportConfig
exchanges:
  mexc_spot:
    api_key: "${MEXC_API_KEY}"  # Set via environment variable MEXC_API_KEY
    secret_key: "${MEXC_SECRET_KEY}"  # Set via environment variable MEXC_SECRET_KEY
    base_url: "https://api.mexc.com"
    websocket_url: "wss://wbs-api.mexc.com/ws"
    enabled: true
    
    # REST Transport Configuration (HFT-optimized for MEXC)
    transport:
      # Performance Targets
      max_latency_ms: 40.0              # MEXC has good latency characteristics
      target_throughput_rps: 100.0      # Target throughput for HFT
      max_retry_attempts: 2              # Fast failure for HFT
      
      # Connection Settings (aggressive for HFT)
      connection_timeout_ms: 1500.0      # Fast connection establishment
      read_timeout_ms: 4000.0            # Fast read timeout
      max_concurrent_requests: 5         # MEXC-specific concurrency limit
      
      # Rate Limiting (MEXC: 1200 req/min = 20 req/sec)
      requests_per_second: 20.0          # Conservative for stability
      burst_capacity: 60                 # 3x burst capacity
      
      # Advanced Settings
      enable_connection_pooling: true
      enable_compression: true
      user_agent: "HFTArbitrageEngine-MEXC/1.0"
      
  gateio_spot:
    api_key: "${GATEIO_API_KEY}"  # Set via environment variable GATEIO_API_KEY (empty for public-only access)
    secret_key: "${GATEIO_SECRET_KEY}"  # Set via environment variable GATEIO_SECRET_KEY (empty for public-only access)
    base_url: "https://api.gateio.ws/api/v4"  # Production URL
    websocket_url: "wss://api.gateio.ws/ws/v4/"  # Production WebSocket URL
    enabled: true
    
    # REST Transport Configuration (HFT-optimized for Gate.io)
    transport:
      # Performance Targets  
      max_latency_ms: 60.0              # Gate.io typically has higher latency
      target_throughput_rps: 80.0       # Conservative target
      max_retry_attempts: 3              # More retries due to higher latency
      
      # Connection Settings (balanced for Gate.io)
      connection_timeout_ms: 2500.0      # Longer for Gate.io
      read_timeout_ms: 6000.0            # Longer read timeout
      max_concurrent_requests: 8         # Higher concurrency for Gate.io
      
      # Rate Limiting (Gate.io: 200 req/10sec = 20 req/sec)
      requests_per_second: 15.0          # Conservative under limit
      burst_capacity: 45                 # 3x burst capacity
      
      # Advanced Settings
      enable_connection_pooling: true
      enable_compression: true
      user_agent: "HFTArbitrageEngine-GATEIO/1.0"

  gateio_futures:
    api_key: "${GATEIO_API_KEY}"  # Same credentials as spot but separate configuration
    secret_key: "${GATEIO_SECRET_KEY}"  # Same credentials as spot but separate configuration
    base_url: "https://api.gateio.ws/api/v4"  # Same REST API endpoint for futures
    websocket_url: "wss://fx-ws.gateio.ws/v4/ws/usdt/"  # Dedicated futures WebSocket (USDT perpetual)
    websocket_delivery_url: "wss://fx-ws.gateio.ws/v4/ws/delivery/"  # Delivery futures WebSocket
    enabled: true
    
    # REST Transport Configuration (HFT-optimized for Gate.io Futures)
    transport:
      # Performance Targets (slightly higher latency for futures)
      max_latency_ms: 80.0              # Futures typically have higher latency
      target_throughput_rps: 60.0       # More conservative for futures
      max_retry_attempts: 3              # Standard retry attempts
      
      # Connection Settings (balanced for Gate.io futures)
      connection_timeout_ms: 3000.0      # Longer for futures
      read_timeout_ms: 7000.0            # Longer read timeout for futures
      max_concurrent_requests: 6         # Lower concurrency for futures
      
      # Rate Limiting (same limits as spot but more conservative)
      requests_per_second: 12.0          # More conservative for futures
      burst_capacity: 36                 # 3x burst capacity
      
      # Advanced Settings
      enable_connection_pooling: true
      enable_compression: true
      user_agent: "HFTArbitrageEngine-GATEIO-FUTURES/1.0"

# Network configuration
network:
  request_timeout: 10.0  # seconds
  connect_timeout: 5.0   # seconds
  max_retries: 3
  retry_delay: 1.0       # seconds

# Rate limiting
rate_limiting:
  mexc_requests_per_second: 18  # Conservative limit for MEXC
  gateio_requests_per_second: 15  # Conservative limit for Gate.io (200/10s = 20, but use 15)

# WebSocket settings
websocket:
  connect_timeout: 10.0      # seconds
  ping_interval: 20.0        # WebSocket ping interval (built-in mechanism)
  ping_timeout: 10.0         # WebSocket ping timeout
  heartbeat_interval: 25.0   # Custom heartbeat interval for exchange-specific ping (reduced to avoid conflicts)
  max_reconnect_attempts: 10
  reconnect_delay: 1.0       # Faster reconnection for 1005 errors
  reconnect_backoff: 2.0     # Exponential backoff multiplier
  max_reconnect_delay: 30.0  # Maximum delay between reconnects
  close_timeout: 5.0         # Connection close timeout
  max_message_size: 1048576  # 1MB max message size
  max_queue_size: 1000       # Max message queue size
  enable_compression: true   # Enable compression for performance

# HFT Arbitrage Engine Configuration
arbitrage:
  # Engine settings
  engine_name: "hft_arbitrage_main"
  enabled_opportunity_types:
    - "SPOT_SPOT"
    - "SPOT_FUTURES_HEDGE"
  enabled_exchanges:
    - "MEXC"
    - "GATEIO"
    - "GATEIO_FUTURES"

  # Performance settings (HFT targets)
  target_execution_time_ms: 30      # Target <50ms for HFT compliance
  opportunity_scan_interval_ms: 100  # Scan every 100ms
  position_monitor_interval_ms: 1000 # Monitor positions every 1s
  balance_refresh_interval_ms: 5000  # Refresh balances every 5s
  market_data_staleness_ms: 100     # Max 100ms data age for HFT

  # Risk management limits
  risk_limits:
    max_position_size_usd: 5000.0      # Maximum single position size
    max_total_exposure_usd: 25000.0    # Maximum total exposure across all positions
    max_exchange_exposure_usd: 15000.0 # Maximum exposure per exchange
    max_symbol_exposure_usd: 10000.0   # Maximum exposure per trading pair
    max_daily_loss_usd: 2500.0         # Maximum daily loss threshold
    max_single_loss_usd: 500.0         # Maximum loss per single arbitrage
    min_profit_margin_bps: 50          # Minimum 0.5% profit margin
    stop_loss_threshold_bps: 200       # 2% stop loss threshold
    max_execution_time_ms: 45000       # Maximum 45 second execution time
    max_slippage_bps: 25               # Maximum 0.25% slippage
    max_partial_fill_ratio: 0.1        # Maximum 10% partial fill ratio
    max_concurrent_operations: 3       # Maximum concurrent arbitrage operations
    max_price_deviation_bps: 100       # Maximum 1% price deviation from fair value
    min_market_depth_usd: 50000.0      # Minimum $50k order book depth required
    max_spread_bps: 500                # Maximum 5% bid-ask spread tolerance
    volatility_circuit_breaker_bps: 1000 # 10% volatility circuit breaker
    max_recovery_attempts: 3           # Maximum position recovery attempts
    recovery_timeout_seconds: 300      # 5 minute recovery timeout
    emergency_close_threshold_bps: 500 # 5% emergency position close threshold

  # Safety features
  enable_risk_checks: true          # Enable real-time risk validation
  enable_circuit_breakers: true     # Enable automated circuit breakers
  enable_websocket_feeds: true      # Use WebSocket for real-time data
  websocket_fallback_to_rest: true  # Fallback to REST if WebSocket fails
  enable_dry_run: true              # DRY RUN MODE: Default enabled for safety
  enable_detailed_logging: true     # Comprehensive operation logging
  enable_performance_metrics: true  # Detailed performance tracking
  enable_recovery_mode: true        # Automatic position recovery

  # Exchange-specific configurations
  exchange_configs:
    MEXC:
      # MEXC-specific settings can be added here
      priority: 1  # Exchange priority for execution
    GATEIO:
      # Gate.io-specific settings can be added here
      priority: 2  # Exchange priority for execution

  # Arbitrage pairs configuration (simplified)
  # Symbol details are auto-discovered from exchanges using get_exchange_info()
  arbitrage_pairs:
    - id: "wai_usdt_spot_arb"
      base_asset: "WAI"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"  # Cross-exchange spot arbitrage
      min_profit_bps: 30  # Minimum 0.30% profit to execute
      max_exposure_usd: 25000  # Maximum $25k exposure for this pair
      is_enabled: true
      priority: 1  # Highest priority
    - id: "hifi_usdt_spot_arb"
      base_asset: "HIFI"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"
      min_profit_bps: 25  # Minimum 0.25% profit
      max_exposure_usd: 20000  # Maximum $20k exposure
      is_enabled: true
      priority: 2
#    - id: "giga_usdt_spot_arb"
#      base_asset: "GIGA"
#      quote_asset: "USDT"
#      opportunity_type: "SPOT_SPOT"
#      min_profit_bps: 35  # Higher threshold for less liquid pair
#      max_exposure_usd: 15000
#      is_enabled: true
#      priority: 3
    - id: "aiot_usdt_spot_arb"
      base_asset: "AIOT"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"
      min_profit_bps: 40  # Higher for volatile asset
      max_exposure_usd: 10000
      is_enabled: false  # Disabled by default
      priority: 4
    # Additional pairs can be added - symbol info auto-discovered
    - id: "neiroeth_usdt_spot_arb"
      base_asset: "NEIROETH"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"
      min_profit_bps: 45
      max_exposure_usd: 8000
      is_enabled: true
      priority: 5
    - id: "hippo_usdt_spot_arb"
      base_asset: "HIPPO"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"
      min_profit_bps: 50
      max_exposure_usd: 7000
      is_enabled: true
      priority: 7
#    - id: "myria_usdt_spot_arb"
#      base_asset: "MYRIA"
#      quote_asset: "USDT"
#      opportunity_type: "SPOT_SPOT"
#      min_profit_bps: 50
#      max_exposure_usd: 7000
#      is_enabled: true
#      priority: 8
    - id: "myx_usdt_spot_arb"
      base_asset: "MYX"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"
      min_profit_bps: 50
      max_exposure_usd: 7000
      is_enabled: true
      priority: 9
    - id: "tai_usdt_spot_arb"
      base_asset: "TAI"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"
      min_profit_bps: 50
      max_exposure_usd: 7000
      is_enabled: true
      priority: 10
    - id: "ai16z_usdt_spot_arb"
      base_asset: "AI16Z"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"
      min_profit_bps: 50
      max_exposure_usd: 7000
      is_enabled: true
      priority: 11
#    - id: "badger_usdt_spot_arb"
#      base_asset: "BADGER"
#      quote_asset: "USDT"
#      opportunity_type: "SPOT_SPOT"
#      min_profit_bps: 50
#      max_exposure_usd: 7000
#      is_enabled: true
#      priority: 12
    - id: "lunc_usdt_spot_arb"
      base_asset: "LUNC"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"
      min_profit_bps: 50
      max_exposure_usd: 7000
      is_enabled: true
      priority: 12
    - id: "velvet_usdt_spot_arb"
      base_asset: "VELVET"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"
      min_profit_bps: 50
      max_exposure_usd: 7000
      is_enabled: true
      priority: 12
    - id: "f_usdt_spot_arb"
      base_asset: "F"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"
      min_profit_bps: 50
      max_exposure_usd: 7000
      is_enabled: true
      priority: 12
    - id: "aria_usdt_spot_arb"
      base_asset: "ARIA"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"
      min_profit_bps: 50
      max_exposure_usd: 7000
      is_enabled: true
      priority: 12
    - id: "lever_usdt_spot_arb"
      base_asset: "LEVER"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"
      min_profit_bps: 50
      max_exposure_usd: 7000
      is_enabled: true
      priority: 12
    - id: "prcl_usdt_spot_arb"
      base_asset: "PRCL"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"
      min_profit_bps: 50
      max_exposure_usd: 7000
      is_enabled: true
      priority: 12
#    - id: "dood_usdt_spot_arb"
#      base_asset: "DOOD"
#      quote_asset: "USDT"
#      opportunity_type: "SPOT_SPOT"
#      min_profit_bps: 50
#      max_exposure_usd: 7000
#      is_enabled: true
#      priority: 12
    - id: "XPIN_usdt_spot_arb"
      base_asset: "XPIN"
      quote_asset: "USDT"
      opportunity_type: "SPOT_SPOT"
      min_profit_bps: 50
      max_exposure_usd: 7000
      is_enabled: true
      priority: 12
# Data Collector Configuration
data_collector:
  enabled: true
  snapshot_interval: 0.5  # seconds
  analytics_interval: 10  # seconds for summary logging
  exchanges: ["mexc_spot", "gateio_spot", "gateio_futures"]
  
  # Analytics configuration
  analytics:
    arbitrage_threshold: 0.05  # 5% minimum arbitrage opportunity to log
    volume_threshold: 1000  # USD minimum volume threshold
    spread_alert_threshold: 0.1  # 10% spread alert threshold